{% schema %}
{
  "name": "Testimonials Section",
  "settings": [
    {
      "type": "text",
      "id": "headline",
      "label": "Section Headline",
      "default": "What our customers say"
    },
    {
      "type": "checkbox",
      "id": "enable_carousel",
      "label": "Enable Product Reviews Carousel",
      "default": true,
      "info": "Show product reviews carousel when there are more than 6 testimonials"
    },
    {
      "type": "text",
      "id": "carousel_title",
      "label": "Carousel Title",
      "default": "Product Reviews"
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        {
          "type": "text",
          "id": "quote",
          "label": "Quote"
        },
        {
          "type": "text",
          "id": "author",
          "label": "Author name"
        },
        {
          "type": "image_picker",
          "id": "author_image",
          "label": "Author photo"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Default testimonials"
    }
  ]
}
{% endschema %}

<div class='py-16 px-4 bg-gray-50 min-h-screen'>
  <div class='mx-auto'>
    <!-- Section Header -->
    <div class='text-center mb-12'>
      <h2 class='text-3xl md:text-4xl font-bold text-gray-900 mb-4'>
        {{ section.settings.headline }}
      </h2>
    </div>

    <!-- First 6 Testimonials -->
    {% assign first_six = section.blocks | slice: 0, 6 %}
    <div
      class='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6'
    >
      {% for block in first_six %}
        <div
          class='relative h-[40rem] rounded-lg overflow-hidden shadow-lg hover:shadow-xl transition-shadow duration-300 cursor-pointer'
          data-quote='{{ block.settings.quote | strip_newlines | escape }}'
          data-author='{{ block.settings.author | escape }}'
          data-image='{% if block.settings.author_image %}{{ block.settings.author_image | image_url: width: 2000 | escape }}{% endif %}'
          onclick='(function(el){window.dispatchEvent(new CustomEvent("open-testimonial",{detail:{quote:el.getAttribute("data-quote"),author:el.getAttribute("data-author"),author_image:el.getAttribute("data-image")||null}}))})(this)'
        >
          <!-- Background Image -->
          {% if block.settings.author_image %}
            <img
              src='{{ block.settings.author_image | image_url: width: 400 }}'
              alt='Photo of {{ block.settings.author }}'
              class='w-full h-full object-cover object-[50%_50%]'
            >
          {% else %}
            <div class='w-full h-full bg-gray-300 flex items-center justify-center'>
              <span class='text-gray-500 text-sm'>No image</span>
            </div>
          {% endif %}

          <!-- Content Overlay with Background -->
          <div class='absolute bottom-0 left-0 right-0 p-6 text-white bg-black/60'>
            <!-- Quote -->
            <blockquote class='text-white text-sm leading-relaxed mb-3 italic'>
              "{{ block.settings.quote }}"
            </blockquote>

            <!-- Author Name -->
            <cite class='text-white font-semibold not-italic text-sm'>
              {{ block.settings.author }}
            </cite>
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- Product Reviews Carousel (if enabled and more than 6 testimonials) -->
    {% if section.settings.enable_carousel and section.blocks.size > 6 %}
      <div class='mt-16'>
        <h3 class='text-2xl font-bold text-gray-900 text-center mb-8'>
          {{ section.settings.carousel_title }}
        </h3>

        <!-- Swiper Carousel -->
        <swiper-container
          class='testimonials-carousel'
          pagination='true'
          pagination-clickable='true'
          navigation='false'
          space-between='20'
          slides-per-view='1'
          centered-slides='true'
          autoplay='true'
          autoplay-delay='5000'
          autoplay-disable-on-interaction='false'
          loop='false'
        >
          {% assign has_reviews = false %}
          {% for product in collections.all.products %}
            {% if product.reviews.size > 0 %}
              {% assign has_reviews = true %}
              {% for review in product.reviews %}
                <swiper-slide>
                  <div class='bg-white rounded-lg shadow-lg overflow-hidden mx-2'>
                    <div class='flex h-80'>
                      <div class='w-1/2 relative'>
                        {% if product.featured_image %}
                          <img
                            src='{{ product.featured_image | img_url: "400x400" }}'
                            alt='{{ product.title }}'
                            class='w-full h-full object-cover'
                          >
                        {% else %}
                          <div class='w-full h-full bg-gray-200 flex items-center justify-center'>
                            <span class='text-gray-500'>No image</span>
                          </div>
                        {% endif %}
                      </div>
                      <div class='w-1/2 p-8 flex flex-col justify-center'>
                        <div class='flex items-center mb-4'>
                          <div class='flex text-yellow-400 mr-3'>
                            {% for i in (1..5) %}
                              {% if i <= review.rating %}
                                <svg
                                  class='w-5 h-5 fill-current'
                                  viewBox='0 0 20 20'
                                >
                                  <path d='M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z'/>
                                </svg>
                              {% else %}
                                <svg
                                  class='w-5 h-5 text-gray-300'
                                  viewBox='0 0 20 20'
                                >
                                  <path d='M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z'/>
                                </svg>
                              {% endif %}
                            {% endfor %}
                          </div>
                          <span class='text-sm text-gray-600 font-medium'>
                            {{- review.rating }}/5</span
                          >
                        </div>
                        <blockquote class='text-gray-800 text-lg leading-relaxed mb-6 italic'>
                          "{{ review.content }}"
                        </blockquote>
                        <div class='flex items-center'>
                          <div class='w-12 h-12 bg-gray-300 rounded-full mr-4 flex items-center justify-center'>
                            <span class='text-gray-600 font-semibold text-sm'>
                              {{- review.author | slice: 0, 1 | upcase -}}
                            </span>
                          </div>
                          <div>
                            <cite class='text-gray-900 font-semibold not-italic text-base block'>
                              {{- review.author -}}
                            </cite>
                            <p class='text-sm text-gray-500'>
                              {{ product.title }}
                            </p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </swiper-slide>
              {% endfor %}
            {% endif %}
          {% endfor %}

          {% unless has_reviews %}
            <swiper-slide>
              <div class='bg-white rounded-lg shadow-lg overflow-hidden mx-2'>
                <div class='flex h-80'>
                  <div class='w-1/2 relative'>
                    {{
                      "product-1"
                      | placeholder_svg_tag: "w-full h-full bg-gray-200 object-cover"
                    }}
                  </div>
                  <div class='w-1/2 p-8 flex flex-col justify-center'>
                    <div class='flex items-center mb-4'>
                      <div class='flex text-yellow-400 mr-3'>
                        {% for i in (1..5) %}
                          <svg class='w-5 h-5 fill-current' viewBox='0 0 20 20'>
                            <path d='M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z'/>
                          </svg>
                        {% endfor %}
                      </div>
                      <span class='text-sm text-gray-600 font-medium'>5/5</span>
                    </div>
                    <blockquote class='text-gray-800 text-lg leading-relaxed mb-6 italic'>
                      "Being a professional guide and a son of a ranch butcher,
                      I've skinned a lot of animals and a knife that can hold a
                      sharp edge is a must. I've used many brands of knives and
                      Kestrel Knives are the only one I've found that can hold a
                      sharp edge the longest."
                    </blockquote>
                    <div class='flex items-center'>
                      <div class='w-12 h-12 bg-gray-300 rounded-full mr-4 flex items-center justify-center'>
                        <span class='text-gray-600 font-semibold text-sm'
                          >L</span
                        >
                      </div>
                      <div>
                        <cite class='text-gray-900 font-semibold not-italic text-base block'
                          >Latigo Hext</cite
                        >
                        <p class='text-sm text-gray-500'>Ovis Scalpel</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </swiper-slide>

            <swiper-slide>
              <div class='bg-white rounded-lg shadow-lg overflow-hidden mx-2'>
                <div class='flex h-80'>
                  <div class='w-1/2 relative'>
                    {{
                      "product-2"
                      | placeholder_svg_tag: "w-full h-full bg-gray-200 object-cover"
                    }}
                  </div>
                  <div class='w-1/2 p-8 flex flex-col justify-center'>
                    <div class='flex items-center mb-4'>
                      <div class='flex text-yellow-400 mr-3'>
                        {% for i in (1..4) %}
                          <svg class='w-5 h-5 fill-current' viewBox='0 0 20 20'>
                            <path d='M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z'/>
                          </svg>
                        {% endfor %}
                        <svg class='w-5 h-5 text-gray-300' viewBox='0 0 20 20'>
                          <path d='M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z'/>
                        </svg>
                      </div>
                      <span class='text-sm text-gray-600 font-medium'>4/5</span>
                    </div>
                    <blockquote class='text-gray-800 text-lg leading-relaxed mb-6 italic'>
                      "Excellent craftsmanship and attention to detail. The
                      blade stays sharp through heavy use and the handle
                      provides a comfortable grip. Highly recommend for any
                      outdoor enthusiast."
                    </blockquote>
                    <div class='flex items-center'>
                      <div class='w-12 h-12 bg-gray-300 rounded-full mr-4 flex items-center justify-center'>
                        <span class='text-gray-600 font-semibold text-sm'
                          >M</span
                        >
                      </div>
                      <div>
                        <cite class='text-gray-900 font-semibold not-italic text-base block'
                          >Mike Johnson</cite
                        >
                        <p class='text-sm text-gray-500'>Ovis Hunter</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </swiper-slide>

            <swiper-slide>
              <div class='bg-white rounded-lg shadow-lg overflow-hidden mx-2'>
                <div class='flex h-80'>
                  <div class='w-1/2 relative'>
                    {{
                      "product-3"
                      | placeholder_svg_tag: "w-full h-full bg-gray-200 object-cover"
                    }}
                  </div>
                  <div class='w-1/2 p-8 flex flex-col justify-center'>
                    <div class='flex items-center mb-4'>
                      <div class='flex text-yellow-400 mr-3'>
                        {% for i in (1..5) %}
                          <svg class='w-5 h-5 fill-current' viewBox='0 0 20 20'>
                            <path d='M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z'/>
                          </svg>
                        {% endfor %}
                      </div>
                      <span class='text-sm text-gray-600 font-medium'>5/5</span>
                    </div>
                    <blockquote class='text-gray-800 text-lg leading-relaxed mb-6 italic'>
                      "This knife exceeded my expectations. The titanium
                      construction makes it incredibly lightweight while
                      maintaining strength. Perfect for backpacking and hunting
                      trips."
                    </blockquote>
                    <div class='flex items-center'>
                      <div class='w-12 h-12 bg-gray-300 rounded-full mr-4 flex items-center justify-center'>
                        <span class='text-gray-600 font-semibold text-sm'
                          >S</span
                        >
                      </div>
                      <div>
                        <cite class='text-gray-900 font-semibold not-italic text-base block'
                          >Sarah Williams</cite
                        >
                        <p class='text-sm text-gray-500'>Titanium EDC</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </swiper-slide>
          {% endunless %}
        </swiper-container>
      </div>
    {% endif %}

    <!-- Swiper Styles -->
    <style>
      .testimonials-carousel {
        width: 100%;
        height: 400px;
      }

      .testimonials-carousel swiper-slide {
        text-align: center;
        font-size: 18px;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .testimonials-carousel swiper-slide img {
        display: block;
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      /* Custom Pagination Styles */
      .testimonials-carousel .swiper-pagination {
        position: relative !important;
        bottom: 0 !important;
        margin-top: 20px;
      }

      .testimonials-carousel .swiper-pagination-bullet {
        background: rgba(0, 0, 0, 0.5);
        opacity: 1;
        width: 12px;
        height: 12px;
        margin: 0 4px;
      }

      .testimonials-carousel .swiper-pagination-bullet-active {
        background: #3b82f6;
      }
    </style>

    <!-- Initialize Swiper -->
    <script>
      // Wait for Swiper web components to be defined since it's loaded with defer
      document.addEventListener('DOMContentLoaded', function () {
        const initCarousels = () => {
          document
            .querySelectorAll('.testimonials-carousel')
            .forEach((el, index) => {
              if (el && el.swiper) {
                console.log(`Carousel ${index} already initialized`)
                return
              }
              if (typeof el.initialize === 'function') {
                // Count slides before initializing
                const slides = el.querySelectorAll('swiper-slide')
                console.log(`Carousel ${index} has ${slides.length} slides`)

                // Only enable loop if there are multiple slides
                if (slides.length > 1) {
                  el.setAttribute('loop', 'true')
                  console.log(
                    `Enabled loop for carousel ${index} (${slides.length} slides)`
                  )
                } else {
                  el.setAttribute('loop', 'false')
                  console.log(
                    `Disabled loop for carousel ${index} (${slides.length} slides)`
                  )
                }

                el.initialize()
                console.log(`Testimonials carousel ${index} initialized`)

                // Check if pagination is working
                setTimeout(() => {
                  const pagination = el.querySelector('.swiper-pagination')
                  console.log('Pagination element:', pagination)
                  if (pagination) {
                    console.log('Pagination found and should be visible')
                  } else {
                    console.log(
                      'Pagination not found - this might be the issue'
                    )
                  }
                }, 100)
              } else {
                console.log(
                  `Carousel ${index} initialize function not available yet`
                )
              }
            })
        }

        // Try immediately, then retry after a short delay if needed
        initCarousels()
        setTimeout(initCarousels, 200)
        setTimeout(initCarousels, 500) // Extra retry
      })
    </script>

    <!-- Remaining Testimonials (if more than 6) -->
    {% if section.blocks.size > 6 %}
      {% assign remaining_blocks = section.blocks
        | slice: 6, section.blocks.size
      %}
      <div class='mt-8'>
        <div class='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6'>
          {% for block in remaining_blocks %}
            <div
              class='relative h-[40rem] rounded-lg overflow-hidden shadow-lg hover:shadow-xl transition-shadow duration-300 cursor-pointer'
              data-quote='{{ block.settings.quote | strip_newlines | escape }}'
              data-author='{{ block.settings.author | escape }}'
              data-image='{% if block.settings.author_image %}{{ block.settings.author_image | image_url: width: 2000 | escape }}{% endif %}'
              onclick='(function(el){window.dispatchEvent(new CustomEvent("open-testimonial",{detail:{quote:el.getAttribute("data-quote"),author:el.getAttribute("data-author"),author_image:el.getAttribute("data-image")||null}}))})(this)'
            >
              <!-- Background Image -->
              {% if block.settings.author_image %}
                <img
                  src='{{ block.settings.author_image | image_url: width: 400 }}'
                  alt='Photo of {{ block.settings.author }}'
                  class='w-full h-full object-cover object-[50%_50%]'
                >
              {% else %}
                <div class='w-full h-full bg-gray-300 flex items-center justify-center'>
                  <span class='text-gray-500 text-sm'>No image</span>
                </div>
              {% endif %}

              <!-- Content Overlay with Background -->
              <div class='absolute bottom-0 left-0 right-0 p-6 text-white bg-black/60'>
                <!-- Quote -->
                <blockquote class='text-white text-sm leading-relaxed mb-3 italic'>
                  "{{ block.settings.quote }}"
                </blockquote>

                <!-- Author Name -->
                <cite class='text-white font-semibold not-italic text-sm'>
                  {{ block.settings.author }}
                </cite>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    {% if section.settings.enable_carousel and section.blocks.size <= 6 %}
      <div class='mt-16'>
        <h3 class='text-2xl font-bold text-gray-900 text-center mb-8'>
          {{ section.settings.carousel_title }}
        </h3>

        <swiper-container
          class='testimonials-carousel'
          pagination='true'
          pagination-clickable='true'
          navigation='false'
          space-between='20'
          slides-per-view='1'
          centered-slides='true'
          autoplay='true'
          autoplay-delay='5000'
          autoplay-disable-on-interaction='false'
          loop='false'
        >
          {% assign has_reviews = false %}
          {% for product in collections.all.products %}
            {% if product.reviews.size > 0 %}
              {% assign has_reviews = true %}
              {% for review in product.reviews %}
                <swiper-slide>
                  <div class='bg-white rounded-lg shadow-lg overflow-hidden mx-2'>
                    <div class='flex h-80'>
                      <div class='w-1/2 relative'>
                        {% if product.featured_image %}
                          <img
                            src='{{ product.featured_image | img_url: "400x400" }}'
                            alt='{{ product.title }}'
                            class='w-full h-full object-cover'
                          >
                        {% else %}
                          <div class='w-full h-full bg-gray-200 flex items-center justify-center'>
                            <span class='text-gray-500'>No image</span>
                          </div>
                        {% endif %}
                      </div>
                      <div class='w-1/2 p-8 flex flex-col justify-center'>
                        <div class='flex items-center mb-4'>
                          <div class='flex text-yellow-400 mr-3'>
                            {% for i in (1..5) %}
                              {% if i <= review.rating %}
                                <svg
                                  class='w-5 h-5 fill-current'
                                  viewBox='0 0 20 20'
                                >
                                  <path d='M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z'/>
                                </svg>
                              {% else %}
                                <svg
                                  class='w-5 h-5 text-gray-300'
                                  viewBox='0 0 20 20'
                                >
                                  <path d='M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z'/>
                                </svg>
                              {% endif %}
                            {% endfor %}
                          </div>
                          <span class='text-sm text-gray-600 font-medium'>
                            {{- review.rating }}/5</span
                          >
                        </div>
                        <blockquote class='text-gray-800 text-lg leading-relaxed mb-6 italic'>
                          "{{ review.content }}"
                        </blockquote>
                        <div class='flex items-center'>
                          <div class='w-12 h-12 bg-gray-300 rounded-full mr-4 flex items-center justify-center'>
                            <span class='text-gray-600 font-semibold text-sm'>
                              {{- review.author | slice: 0, 1 | upcase -}}
                            </span>
                          </div>
                          <div>
                            <cite class='text-gray-900 font-semibold not-italic text-base block'>
                              {{- review.author -}}
                            </cite>
                            <p class='text-sm text-gray-500'>
                              {{ product.title }}
                            </p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </swiper-slide>
              {% endfor %}
            {% endif %}
          {% endfor %}

          {% unless has_reviews %}
            <!-- Placeholder Review 1 -->
            <swiper-slide>
              <div class='bg-white rounded-lg shadow-lg overflow-hidden mx-2'>
                <div class='flex h-80'>
                  <div class='w-1/2 relative'>
                    {{
                      "product-1"
                      | placeholder_svg_tag: "w-full h-full bg-gray-200 object-cover"
                    }}
                  </div>
                  <div class='w-1/2 p-8 flex flex-col justify-center'>
                    <div class='flex items-center mb-4'>
                      <div class='flex text-yellow-400 mr-3'>
                        {% for i in (1..5) %}
                          <svg class='w-5 h-5 fill-current' viewBox='0 0 20 20'>
                            <path d='M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z'/>
                          </svg>
                        {% endfor %}
                      </div>
                      <span class='text-sm text-gray-600 font-medium'>5/5</span>
                    </div>
                    <blockquote class='text-gray-800 text-lg leading-relaxed mb-6 italic'>
                      "Being a professional guide and a son of a ranch butcher,
                      I've skinned a lot of animals and a knife that can hold a
                      sharp edge is a must. I've used many brands of knives and
                      Kestrel Knives are the only one I've found that can hold a
                      sharp edge the longest."
                    </blockquote>
                    <div class='flex items-center'>
                      <div class='w-12 h-12 bg-gray-300 rounded-full mr-4 flex items-center justify-center'>
                        <span class='text-gray-600 font-semibold text-sm'
                          >L</span
                        >
                      </div>
                      <div>
                        <cite class='text-gray-900 font-semibold not-italic text-base block'
                          >Latigo Hext</cite
                        >
                        <p class='text-sm text-gray-500'>Ovis Scalpel</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </swiper-slide>

            <!-- Placeholder Review 2 -->
            <swiper-slide>
              <div class='bg-white rounded-lg shadow-lg overflow-hidden mx-2'>
                <div class='flex h-80'>
                  <div class='w-1/2 relative'>
                    {{
                      "product-2"
                      | placeholder_svg_tag: "w-full h-full bg-gray-200 object-cover"
                    }}
                  </div>
                  <div class='w-1/2 p-8 flex flex-col justify-center'>
                    <div class='flex items-center mb-4'>
                      <div class='flex text-yellow-400 mr-3'>
                        {% for i in (1..4) %}
                          <svg class='w-5 h-5 fill-current' viewBox='0 0 20 20'>
                            <path d='M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z'/>
                          </svg>
                        {% endfor %}
                        <svg class='w-5 h-5 text-gray-300' viewBox='0 0 20 20'>
                          <path d='M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z'/>
                        </svg>
                      </div>
                      <span class='text-sm text-gray-600 font-medium'>4/5</span>
                    </div>
                    <blockquote class='text-gray-800 text-lg leading-relaxed mb-6 italic'>
                      "Excellent craftsmanship and attention to detail. The
                      blade stays sharp through heavy use and the handle
                      provides a comfortable grip. Highly recommend for any
                      outdoor enthusiast."
                    </blockquote>
                    <div class='flex items-center'>
                      <div class='w-12 h-12 bg-gray-300 rounded-full mr-4 flex items-center justify-center'>
                        <span class='text-gray-600 font-semibold text-sm'
                          >M</span
                        >
                      </div>
                      <div>
                        <cite class='text-gray-900 font-semibold not-italic text-base block'
                          >Mike Johnson</cite
                        >
                        <p class='text-sm text-gray-500'>Ovis Hunter</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </swiper-slide>

            <!-- Placeholder Review 3 -->
            <swiper-slide>
              <div class='bg-white rounded-lg shadow-lg overflow-hidden mx-2'>
                <div class='flex h-80'>
                  <div class='w-1/2 relative'>
                    {{
                      "product-3"
                      | placeholder_svg_tag: "w-full h-full bg-gray-200 object-cover"
                    }}
                  </div>
                  <div class='w-1/2 p-8 flex flex-col justify-center'>
                    <div class='flex items-center mb-4'>
                      <div class='flex text-yellow-400 mr-3'>
                        {% for i in (1..5) %}
                          <svg class='w-5 h-5 fill-current' viewBox='0 0 20 20'>
                            <path d='M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z'/>
                          </svg>
                        {% endfor %}
                      </div>
                      <span class='text-sm text-gray-600 font-medium'>5/5</span>
                    </div>
                    <blockquote class='text-gray-800 text-lg leading-relaxed mb-6 italic'>
                      "This knife exceeded my expectations. The titanium
                      construction makes it incredibly lightweight while
                      maintaining strength. Perfect for backpacking and hunting
                      trips."
                    </blockquote>
                    <div class='flex items-center'>
                      <div class='w-12 h-12 bg-gray-300 rounded-full mr-4 flex items-center justify-center'>
                        <span class='text-gray-600 font-semibold text-sm'
                          >S</span
                        >
                      </div>
                      <div>
                        <cite class='text-gray-900 font-semibold not-italic text-base block'
                          >Sarah Williams</cite
                        >
                        <p class='text-sm text-gray-500'>Titanium EDC</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </swiper-slide>
          {% endunless %}
        </swiper-container>
      </div>
    {% endif %}

    <!-- Empty State -->
    {% if section.blocks.size == 0 %}
      <div class='text-center py-12'>
        <p class='text-gray-500 text-lg'>
          No testimonials added yet. Add some testimonials in the theme editor.
        </p>
      </div>
    {% endif %}
  </div>
</div>

<!-- Testimonial Modal -->
<div
  x-data='testimonialModal()'
  x-show='isOpen'
  x-transition:enter='transition ease-out duration-300'
  x-transition:enter-start='opacity-0'
  x-transition:enter-end='opacity-100'
  x-transition:leave='transition ease-in duration-200'
  x-transition:leave-start='opacity-100'
  x-transition:leave-end='opacity-0'
  class='fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75'
  @click.self='closeModal()'
  style='display: none;'
>
  <div
    class='relative max-w-4xl max-h-[90vh] w-full mx-4 rounded-lg overflow-hidden'
    x-transition:enter='transition ease-out duration-300'
    x-transition:enter-start='opacity-0 scale-95'
    x-transition:enter-end='opacity-100 scale-100'
    x-transition:leave='transition ease-in duration-200'
    x-transition:leave-start='opacity-100 scale-100'
    x-transition:leave-end='opacity-0 scale-95'
  >
    <!-- Close Button -->
    <button
      @click='closeModal()'
      class='absolute top-4 right-4 z-10 bg-black bg-opacity-50 text-white rounded-full p-2 hover:bg-opacity-75 transition-colors'
    >
      <svg
        class='w-6 h-6'
        fill='none'
        stroke='currentColor'
        viewBox='0 0 24 24'
      >
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M6 18L18 6M6 6l12 12'></path>
      </svg>
    </button>

    <!-- Modal Content -->
    <div class='flex flex-col h-full'>
      <!-- Full Image -->
      <div class='relative'>
        <template x-if='selectedTestimonial && selectedTestimonial.author_image'>
          <img
            :src='selectedTestimonial.author_image'
            :alt='`Photo of ${selectedTestimonial.author}`'
            class='w-full h-full object-cover object-top'
          >
        </template>
        <template x-if='!selectedTestimonial || !selectedTestimonial.author_image'>
          <div class='w-full h-full bg-gray-300 flex items-center justify-center'>
            <span class='text-gray-500 text-lg'>No image</span>
          </div>
        </template>
      </div>

      <!-- Review Content -->
      <div class='p-8 bg-black/40 absolute bottom-0 left-0 right-0'>
        <div class='text-center'>
          <blockquote class='text-white text-lg md:text-xl leading-relaxed mb-6 italic'>
            <span
              x-text='selectedTestimonial ? `"${selectedTestimonial.quote}"` : ""'
            ></span>
          </blockquote>

          <cite class='text-white font-semibold not-italic text-lg md:text-xl'>
            <span
              x-text='selectedTestimonial ? selectedTestimonial.author : ""'
            ></span>
          </cite>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Alpine.js Modal Functionality -->
<script>
  window.decodeHtmlEntities = function (str) {
    if (!str) return str
    const txt = document.createElement('textarea')
    txt.innerHTML = str
    return txt.value
  }

  function testimonialModal() {
    return {
      isOpen: false,
      selectedTestimonial: null,

      openModal(testimonial) {
        this.selectedTestimonial = testimonial
        this.isOpen = true
        document.body.style.overflow = 'hidden'
      },

      closeModal() {
        this.isOpen = false
        this.selectedTestimonial = null
        document.body.style.overflow = 'auto'
      },
      init() {
        window.addEventListener('open-testimonial', e => {
          this.openModal(e.detail)
        })
      },
    }
  }
</script>
