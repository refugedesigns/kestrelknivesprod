<div
  class='bg-gray-50'
  x-data='faqPage()'
>
  <!-- Header Section -->
  <header
    class='text-white relative overflow-hidden flex items-center justify-center'
    style='background-color: {{ section.settings.header_bg_color | default: "#000000" }}; min-height: {{ section.settings.header_height | default: "200" }}px; padding-top: {{ section.settings.header_padding_top | default: "4" }}rem; padding-bottom: {{ section.settings.header_padding_bottom | default: "4" }}rem; {% if section.settings.header_border_bottom %}border-bottom: 2px solid {{ section.settings.header_border_color | default: "#ffffff" }};{% endif %}'
  >
    <div class='container mx-auto px-4 relative z-10 flex flex-col items-center justify-center'>
      <div class='text-center'>
        <h1
          class='text-5xl font-bold mb-4'
          style='color: {{ section.settings.title_color | default: "#ffffff" }};'
        >
          {{
            section.settings.page_title
            | default: "Frequently Asked Questions"
          }}
        </h1>
        <p
          class='text-xl opacity-90 max-w-2xl mx-auto leading-relaxed'
          style='color: {{ section.settings.subtitle_color | default: "#ffffff" }};'
        >
          {{
            section.settings.page_subtitle
            | default: "Find answers to common questions about our services, billing, and support."
          }}
        </p>
      </div>
    </div>
  </header>

  <!-- Search and Filter Section -->
  <div class='container mx-auto px-4 py-8'>
    <div class='max-w-4xl mx-auto'>
      <!-- Search Bar -->
      <div class='bg-white rounded-2xl shadow-lg p-6 mb-8 hover:transform hover:-translate-y-1 transition-all duration-300'>
        <div class='relative'>
          <input
            type='text'
            x-model='searchTerm'
            placeholder='Search for questions...'
            class='w-full pl-14 pr-4 py-4 text-lg border-2 border-gray-200 rounded-xl focus:border-black focus:outline-none focus:ring-4 focus:ring-gray-100 transition-all duration-300'
          >
          <svg
            class='absolute left-5 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5'
            fill='none'
            stroke='currentColor'
            viewBox='0 0 24 24'
          >
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
        </div>
      </div>

      <!-- Category Filters -->
      <div class='bg-white rounded-2xl shadow-lg p-6 mb-8 hover:transform hover:-translate-y-1 transition-all duration-300'>
        <h3 class='text-lg font-semibold mb-4 text-gray-800'>
          Filter by Category
        </h3>
        <div class='flex flex-wrap gap-4'>
          <button
            x-on:click="filterByCategory('all')"
            :class="activeCategory === 'all' ? 'bg-black text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'"
            class='px-6 py-2 rounded-full cursor-pointer font-medium transition-all duration-300'
          >
            All Questions
          </button>
          {% assign categories = section.settings.categories | split: "," %}
          {% for category in categories %}
            <button
              x-on:click="filterByCategory('{{ category | strip | handle }}')"
              :class="activeCategory === '{{ category | strip | handle }}' ? 'bg-black text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'"
              class='px-6 py-2 rounded-full cursor-pointer font-medium transition-all duration-300'
            >
              {{ category | strip }}
            </button>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>

  <!-- FAQ Section -->
  <div class='container mx-auto px-4 pb-16'>
    <div class='max-w-4xl mx-auto'>
      {% for block in section.blocks %}
        <div
          class='bg-white rounded-2xl shadow-lg mb-4 overflow-hidden hover:transform hover:-translate-y-1 transition-all duration-300'
          data-category='{{ block.settings.category | handle }}'
          data-question='{{ block.settings.question | downcase }}'
          data-answer='{{ block.settings.answer | downcase }}'
          x-show='isVisible()'
        >
          <button
            class='w-full text-left p-6 focus:outline-none focus:ring-4 focus:ring-gray-100'
            x-on:click='toggleFAQ("{{ block.id }}")'
          >
            <div class='flex justify-between items-center'>
              <h3 class='text-xl font-semibold text-gray-800 pr-4'>
                {{ block.settings.question }}
              </h3>
              <svg
                class='text-black w-5 h-5 transform transition-transform duration-300'
                :class="{ 'rotate-180': openFAQs.includes('{{ block.id }}') }"
                fill='none'
                stroke='currentColor'
                viewBox='0 0 24 24'
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </div>
          </button>
          <div
            class='faq-answer px-6 pb-0'
            :class="{ 'open': openFAQs.includes('{{ block.id }}') }"
            x-show="openFAQs.includes('{{ block.id }}')"
            x-transition:enter='transition ease-out duration-300'
            x-transition:enter-start='opacity-0 max-h-0'
            x-transition:enter-end='opacity-100 max-h-96'
            x-transition:leave='transition ease-in duration-200'
            x-transition:leave-start='opacity-100 max-h-96'
            x-transition:leave-end='opacity-0 max-h-0'
          >
            <div class='border-t border-gray-100 pt-6 pb-6'>
              <div class='text-gray-600 leading-relaxed text-lg'>
                {{ block.settings.answer }}
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>

  <!-- Contact Section -->
  <section class='bg-white py-16 border-t'>
    <div class='container mx-auto px-4'>
      <div class='max-w-4xl mx-auto text-center'>
        <h2 class='text-3xl font-bold text-gray-800 mb-8'>
          {{
            section.settings.contact_title
            | default: "Still have questions?"
          }}
        </h2>
        <div class='flex flex-col sm:flex-row justify-center items-center gap-8 max-w-2xl mx-auto'>
          {% if section.settings.live_chat_text %}
            <div class='flex flex-col items-center text-center'>
              <svg
                class='w-8 h-8 text-gray-600 mb-3'
                fill='currentColor'
                viewBox='0 0 20 20'
              >
                <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path>
              </svg>
              <h3 class='text-lg font-semibold mb-2 text-gray-800'>
                Live Chat
              </h3>
              <p class='text-gray-600'>{{ section.settings.live_chat_text }}</p>
            </div>
          {% endif %}

          {% if section.settings.email_text %}
            <div class='flex flex-col items-center text-center'>
              <svg
                class='w-8 h-8 text-gray-600 mb-3'
                fill='currentColor'
                viewBox='0 0 20 20'
              >
                <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path>
                <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path>
              </svg>
              <h3 class='text-lg font-semibold mb-2 text-gray-800'>
                Email Support
              </h3>
              <p class='text-gray-600'>{{ section.settings.email_text }}</p>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </section>
</div>

<script>
  function faqPage() {
    return {
      searchTerm: '',
      activeCategory: 'all',
      openFAQs: [],

      init() {
        // Initialize with any URL parameters for specific FAQ
        const urlParams = new URLSearchParams(window.location.search)
        const faqId = urlParams.get('faq')
        if (faqId) {
          this.openFAQs.push(faqId)
        }
      },

      toggleFAQ(faqId) {
        if (this.openFAQs.includes(faqId)) {
          this.openFAQs = this.openFAQs.filter(id => id !== faqId)
        } else {
          this.openFAQs.push(faqId)
        }
      },

      filterByCategory(category) {
        this.activeCategory = category
      },

      isVisible() {
        const element = this.$el
        const category = element.dataset.category
        const question = element.dataset.question
        const answer = element.dataset.answer

        // Check category filter
        const categoryMatch =
          this.activeCategory === 'all' ||
          this.activeCategory.toLowerCase() === category.toLowerCase()

        if (!categoryMatch) {
          return false
        }

        // Check search term
        if (this.searchTerm) {
          const searchLower = this.searchTerm.toLowerCase()
          return question.includes(searchLower) || answer.includes(searchLower)
        }

        return true
      },
    }
  }
</script>

<style>
  .faq-answer {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
  }

  .faq-answer.open {
    max-height: 500px;
  }

  html {
    scroll-behavior: smooth;
  }
</style>

{% schema %}
{
  "name": "FAQ Page",
  "settings": [
    {
      "type": "text",
      "id": "page_title",
      "label": "Page Title",
      "default": "Frequently Asked Questions"
    },
    {
      "type": "textarea",
      "id": "page_subtitle",
      "label": "Page Subtitle",
      "default": "Find answers to common questions about our services, billing, and support."
    },
    {
      "type": "text",
      "id": "contact_title",
      "label": "Contact Section Title",
      "default": "Still have questions?"
    },
    {
      "type": "text",
      "id": "live_chat_text",
      "label": "Live Chat Text",
      "default": "Available 24/7 for instant support"
    },
    {
      "type": "text",
      "id": "email_text",
      "label": "Email Support Text",
      "default": "sales@kestrelknives.com"
    },
    {
      "type": "text",
      "id": "categories",
      "label": "FAQ Categories (comma-separated)",
      "default": "General, Billing, Technical, Support",
      "info": "Enter categories separated by commas (e.g., General, Billing, Technical, Support)"
    },
    {
      "type": "header",
      "content": "Header Settings"
    },
    {
      "type": "color",
      "id": "header_bg_color",
      "label": "Header background color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "header_height",
      "label": "Header height",
      "min": 200,
      "max": 600,
      "step": 16,
      "default": 200,
      "unit": "px"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "subtitle_color",
      "label": "Subtitle color",
      "default": "#ffffff"
    },
    {
      "type": "checkbox",
      "id": "header_border_bottom",
      "label": "Show bottom border",
      "default": false
    },
    {
      "type": "color",
      "id": "header_border_color",
      "label": "Bottom border color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "header_padding_top",
      "label": "Header padding top",
      "min": 2,
      "max": 8,
      "step": 0.5,
      "default": 4,
      "unit": "rem"
    },
    {
      "type": "range",
      "id": "header_padding_bottom",
      "label": "Header padding bottom",
      "min": 2,
      "max": 8,
      "step": 0.5,
      "default": 4,
      "unit": "rem"
    }
  ],
  "blocks": [
    {
      "type": "faq_item",
      "name": "FAQ Item",
      "settings": [
        {
          "type": "text",
          "id": "question",
          "label": "Question",
          "default": "How do I create an account?"
        },
        {
          "type": "textarea",
          "id": "answer",
          "label": "Answer",
          "default": "Creating an account is simple! Click the 'Sign Up' button in the top right corner, enter your email address, create a secure password, and verify your email."
        },
        {
          "type": "select",
          "id": "category",
          "label": "Category",
          "default": "General",
          "options": [
            {
              "value": "General",
              "label": "General"
            },
            {
              "value": "Billing",
              "label": "Billing"
            },
            {
              "value": "Technical",
              "label": "Technical"
            },
            {
              "value": "Support",
              "label": "Support"
            }
          ],
          "info": "Select the category for this FAQ item. This will be used for filtering."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "FAQ Page",
      "blocks": [
        {
          "type": "faq_item",
          "settings": {
            "question": "How do I create an account?",
            "answer": "Creating an account is simple! Click the 'Sign Up' button in the top right corner, enter your email address, create a secure password, and verify your email. You'll be ready to start using our platform immediately. The entire process takes less than 2 minutes.",
            "category": "General"
          }
        },
        {
          "type": "faq_item",
          "settings": {
            "question": "Is there a free trial available?",
            "answer": "Yes! We offer a 14-day free trial with full access to all features. No credit card required. You can upgrade to a paid plan anytime during or after your trial period. Experience everything our platform has to offer risk-free.",
            "category": "General"
          }
        },
        {
          "type": "faq_item",
          "settings": {
            "question": "What payment methods do you accept?",
            "answer": "We accept all major credit cards (Visa, MasterCard, American Express), PayPal, and bank transfers for enterprise customers. All payments are processed securely through our encrypted payment system with industry-standard security measures.",
            "category": "Billing"
          }
        },
        {
          "type": "faq_item",
          "settings": {
            "question": "Can I cancel my subscription anytime?",
            "answer": "Absolutely! You can cancel your subscription at any time from your account settings. Your access will continue until the end of your current billing period, and you won't be charged for the next cycle. No cancellation fees or hidden charges.",
            "category": "Billing"
          }
        },
        {
          "type": "faq_item",
          "settings": {
            "question": "What integrations are available?",
            "answer": "We offer integrations with over 100+ popular tools including Slack, Google Workspace, Microsoft Teams, Salesforce, HubSpot, Zapier, and many more. Our RESTful API also allows for custom integrations to fit your specific workflow needs.",
            "category": "Technical"
          }
        },
        {
          "type": "faq_item",
          "settings": {
            "question": "Is my data secure and backed up?",
            "answer": "Security is our top priority. We use enterprise-grade AES-256 encryption, regular third-party security audits, and automated daily backups. Your data is stored in secure, geographically distributed data centers with 99.9% uptime SLA guarantee.",
            "category": "Technical"
          }
        },
        {
          "type": "faq_item",
          "settings": {
            "question": "How can I contact customer support?",
            "answer": "Our support team is available 24/7 through multiple channels: live chat on our website, email at support@example.com, or phone at +1 (555) 123-4567. Premium customers also have access to dedicated account managers for personalized assistance.",
            "category": "Support"
          }
        },
        {
          "type": "faq_item",
          "settings": {
            "question": "Do you offer training and onboarding?",
            "answer": "Yes! We provide comprehensive onboarding for all new customers, including video tutorials, detailed documentation, and live training sessions. Enterprise customers receive personalized onboarding with dedicated success managers and custom training programs.",
            "category": "Support"
          }
        }
      ]
    }
  ]
}
{% endschema %}
